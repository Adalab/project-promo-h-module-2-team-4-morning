"use strict";const collapsibleArr=document.querySelectorAll(".collapsible"),fieldsetArr=document.querySelectorAll("fieldset");for(let e=0;e<collapsibleArr.length;e++){function toggleItem(){toggle(e)}collapsibleArr[e].addEventListener("click",toggleItem)}function toggle(e){const t=fieldsetArr[e],r=t.classList.contains("hidden");fieldsetArr[0].classList.add("hidden"),fieldsetArr[1].classList.add("hidden"),fieldsetArr[2].classList.add("hidden"),r?(t.classList.remove("hidden"),t.classList.add("open")):(t.classList.add("hidden"),t.classList.remove("open"))}const inputArr=document.querySelectorAll(".js-input"),previewArr=document.querySelectorAll(".js-preview"),formValidation=document.querySelector(".js-form-container"),createAllowCard=document.querySelector(".js-share__btn"),colorIConsCard=document.querySelectorAll(".menu__items"),colorInputArr=document.querySelectorAll(".js-input-color"),lsObj={},twitterBtn=document.querySelector(".twitter"),responseURL=document.querySelector(".js-response"),fr=new FileReader,uploadBtn=document.querySelector(".js-fill__image-btn"),fileField=document.querySelector(".js-fill__image-upload-btn"),profileImage=document.querySelector(".preview__display--img"),profilePreview=document.querySelector(".fill__image--miniature");let form=document.querySelector("form");const resetFormBtn=document.querySelector(".preview__reset"),defaultImage="./assets/images/profile.png";function resetForm(){form.reset(),document.querySelector(".preview__display").classList.remove("palette1"),document.querySelector(".preview__display").classList.remove("palette2"),document.querySelector(".preview__display").classList.remove("palette3"),handler(),profileImage.style.backgroundImage=`url(${defaultImage})`,profilePreview.style.backgroundImage="url('')"}function getImage(e){var t=e.currentTarget.files[0];fr.addEventListener("load",writeImage),fr.readAsDataURL(t)}function writeImage(){!0==!!fr.result?(profileImage.style.backgroundImage=`url(${fr.result})`,profilePreview.style.backgroundImage=`url(${fr.result})`,lsObj.image=fr.result,updateLocalStorage()):(profileImage.style.backgroundImage=`url(${defaultImage})`,profilePreview.style.backgroundImage="url('')",lsObj.image=fr.result)}function fakeFileClick(e){e.preventDefault(),fileField.click()}resetFormBtn.addEventListener("click",resetForm),uploadBtn.addEventListener("click",fakeFileClick),fileField.addEventListener("change",getImage);const twitterActive=function(){!0===formValidation.checkValidity()?twitterBtn.classList.remove("hidden"):twitterBtn.classList.add("hidden")};function createButtonHandler(e){e.preventDefault(),twitterActive()}function listenColors(){for(let e=0;e<colorInputArr.length;e++)colorInputArr[e].addEventListener("click",updatePalette)}function updatePalette(){for(let e=0;e<colorInputArr.length;e++){let e=document.querySelector(".preview__display");!0===colorInputArr[0].checked?(e.classList.remove("palette1"),e.classList.remove("palette2"),e.classList.add("palette0"),lsObj.palette=colorInputArr[0].id):!0===colorInputArr[1].checked?(e.classList.remove("palette0"),e.classList.remove("palette2"),e.classList.add("palette1"),lsObj.palette=colorInputArr[1].id):(e.classList.remove("palette0"),e.classList.remove("palette1"),e.classList.add("palette2"),lsObj.palette=colorInputArr[2].id)}updateLocalStorage()}function checkCheck(){!0===formValidation.checkValidity()?createAllowCard.classList.remove("filter"):createAllowCard.classList.add("filter")}function listenInputs(){for(let e=0;e<inputArr.length;e++)inputArr[e].addEventListener("keyup",handler)}createAllowCard.addEventListener("click",createButtonHandler),listenColors(),listenInputs();const defaultPreviewArr=["Nombre Apellido","Front-End Developer","","","",""],hrefArr=[!1,!1,"mailto:","tel:+","https://www.linkedin.com/in/","https://www.github.com/"];function updatePreview(){const e=[];for(let t=0;t<inputArr.length;t++)t<2?!1==!!inputArr[t].value?previewArr[t].innerHTML=defaultPreviewArr[t]:previewArr[t].innerHTML=inputArr[t].value:!1==!!inputArr[t].value?(previewArr[t].href=`${hrefArr[t]}${defaultPreviewArr[t]}`,colorIConsCard[t-2].classList.add("filter")):(previewArr[t].href=`${hrefArr[t]}${inputArr[t].value}`,colorIConsCard[t-2].classList.remove("filter")),lsObj[inputArr[t].id]=inputArr[t].value,e.push(inputArr[t].value);twitterBtn.classList.add("hidden")}function updateLocalStorage(){localStorage.setItem("userData",JSON.stringify(lsObj))}function getFromLocalStorage(){const e=JSON.parse(localStorage.getItem("userData"));if(null!==e){inputArr[0].value=e.name,inputArr[1].value=e.job,inputArr[2].value=e.email,inputArr[3].value=e.phone,inputArr[4].value=e.linkedin,inputArr[5].value=e.github,updatePreview(),profileImage.style.backgroundImage=`url(${e.image})`,profilePreview.style.backgroundImage=`url(${e.image})`,writeImage();for(let t=0;t<colorInputArr.length;t++)colorInputArr[t].id===e.palette&&(colorInputArr[t].setAttribute("checked","checked"),updatePalette());checkCheck()}}function sendData(){let e=getJSONFromInputs(Array.from(formValidation.elements));e.skills=["JavaScript","React"],e.photo=fr.result,sendRequest(e)}function loadPhoto(){const e=document.querySelector("#img-selector").files[0];fr.addEventListener("load",sendData),fr.readAsDataURL(e)}function getJSONFromInputs(e){return e.reduce(function(e,t){return"BUTTON"!==t.nodeName&&(e[t.name]=t.value),e},{})}function sendRequest(e){fetch("https://us-central1-awesome-cards-cf6f0.cloudfunctions.net/card/",{method:"POST",body:JSON.stringify(e),headers:{"content-type":"application/json"}}).then(function(e){return e.json()}).then(function(e){showURL(e)}).catch(function(e){console.log(e)})}function showURL(e){e.success?responseURL.innerHTML="<a href="+e.cardURL+">"+e.cardURL+"</a>":responseURL.innerHTML="ERROR:"+e.error,shareTwitter(e.cardURL)}createAllowCard.addEventListener("click",loadPhoto);const btnTwitter=document.querySelector(".js-button-twitter");function shareTwitter(e){btnTwitter.href=`https://twitter.com/intent/tweet?text=Quiero%20compartir%20mi%20tarjeta%20profesional%20por%20Twitter.&url=${e}%20La%20he%20creado%20en%3A%20&url=https%3A%2F%2Fn9.cl%2F9vmf&hashtags=tarjetavisita,html,css,javascript,businesscard,card,profile`}function handler(){updateLocalStorage(),updatePreview(),updatePalette(),checkCheck()}getFromLocalStorage();